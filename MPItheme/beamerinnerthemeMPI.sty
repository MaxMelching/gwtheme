%% start of file `beamerinnerthemeMPI.sty'.
% Author: Max Melching (m-melching@web.de), 2025
%
% Acknowledgements: this theme is a based on the UC Berkeley beamer theme. The file structure, however, follows the DTU template from https://gitlab.gbar.dtu.dk/latex/dtutemplates/-/tree/master/templates/Beamer

\mode<presentation>

% -- Purpose of this file: specify how things look that make up content of the frame. For example style of enumerations etc or the table of contents

% -- Appearance and margins for items ----------
% \setbeamertemplate{itemize item}{\textbullet}
\setbeamertemplate{itemize item}{$\blacktriangleright$}
\setbeamertemplate{itemize subitem}{--}
\setbeamertemplate{itemize subsubitem}{\textbullet}
\setlength{\leftmargini}{1.25em}
\setlength{\leftmarginii}{1em}
\setlength{\leftmarginiii}{1em}


% -- Text margins
\setbeamersize{text margin left=2em, text margin right=2em}


% -- Captions and TOC
\setbeamertemplate{caption}[numbered]  % How captions of floats appear

\setbeamertemplate{section in toc}[sections numbered]
\setbeamertemplate{subsection in toc}[square]%[subsections numbered]


% -- Section and subsection page ----------
% -> adapted from: https://github.com/pcafrica/focus-beamertheme/blob/main/beamerinnerthemefocus.sty
\defbeamertemplate*{section page}{MPI}{%
    {%
        \begin{tikzpicture}[overlay, remember picture]
            \usebeamercolor[bg]{section page}
            % \fill (current page.north west) rectangle ([shift = {(0, -0.45\paperheight)}] current page.north east);
            \fill (current page.north west) -- +(0, -0.6\paperheight) -- +(\paperwidth, -0.52\paperheight) -- (current page.north east) -- cycle;% I do not fully understand this. But anyway, it works...
        \end{tikzpicture}%
    }
    
    \vspace{-2.5\baselineskip}
    \begin{minipage}[b][0.45\paperheight]{\textwidth}
        \usebeamerfont{sectiontitle}
        \usebeamercolor[fg]{section page}
        \let\hyperlink\@secondoftwo\insertsection
    \end{minipage}

    \vspace{\baselineskip}
    \begin{minipage}[t][0.5\paperheight]{\textwidth}
        % \usebeamerfont{subsectiontitle}
        % \usebeamercolor[bg]{section page}
        % \insertsubsection
    \end{minipage}
}


\defbeamertemplate*{subsection page}{MPI}{%
    {%
        \begin{tikzpicture}[overlay, remember picture]
            \usebeamercolor[bg]{subsection page}
            \fill (current page.north west) rectangle ([shift = {(0, -0.45\paperheight)}] current page.north east);
        \end{tikzpicture}%
    }
    
    \vspace{-2.5\baselineskip}
    \begin{minipage}[b][0.45\paperheight]{\textwidth}
        \usebeamerfont{sectiontitle}
        \usebeamercolor[fg]{subsection page}
        \let\hyperlink\@secondoftwo\insertsection
    \end{minipage}
    
    \vspace{\baselineskip}
    \begin{minipage}[t][0.5\paperheight]{\textwidth}
        \usebeamerfont{subsectiontitle}
        \usebeamercolor[bg]{subsection page}
        \insertsubsection
    \end{minipage}
}


\AtBeginSection[]{%
    \begin{frame}[plain, noframenumbering]{}
        \sectionpage
    \end{frame}%
}
% -- This at most. Looks not too bad

% \AtBeginSubsection[]{%
%     \begin{frame}[plain, noframenumbering]{}
%         \subsectionpage
%     \end{frame}%
% }


% -- Title page ----------
\RequirePackage{tikz}
\RequirePackage{calc}

% \setbeamertemplate{title page}[default][left]

% \setbeamertemplate{title page}{
%   % % \begin{minipage}{0.3\textwidth}%
%   % %     \includegraphics[width=0.3\textwidth]{pictures/aeilogo.png}
%   % % \end{minipage}%
%   % % \begin{minipage}{0.3\textwidth}%
%   % %     \includegraphics[0.3\textwidth]{pictures/group_logo.png}
%   % % \end{minipage}%
%   % % \begin{minipage}{0.3\textwidth}%
%   % %     \includegraphics[0.3\textwidth]{pictures/logo_luh.jpg}
%   % % \end{minipage}%
%   % \begin{figure}[h]
%   %   \centering
%   %   % \subfloat{\includegraphics[height=2.5\baselineskip]{pictures/aeilogo.png}}\hspace*{0.15\textwidth}
%   %   % \subfloat{\includegraphics[height=2.5\baselineskip]{pictures/MPI-AEI_hoch_D_color_rgb-1.png}}\hspace*{0.1\textwidth}
%   %   % \subfloat{\includegraphics[height=2.5\baselineskip]{pictures/group_logo.png}}\hspace*{0.1\textwidth}
%   %   % \subfloat{\includegraphics[height=2\baselineskip]{pictures/logo_luh.jpg}}
%   %   \subfloat{\includegraphics[height=3\baselineskip]{pictures/MPI-AEI_hoch_D_color_rgb-1.png}}\hspace*{0.06\textwidth}
%   %   \subfloat{\includegraphics[height=3\baselineskip]{pictures/group_logo.png}}\hspace*{0.06\textwidth}
%   %   \subfloat{\includegraphics[height=2.2\baselineskip]{pictures/logo_luh.jpg}}
%   % \end{figure}
%   % % \vbox{}
%   \vfill
%   \begingroup
%     \begin{beamercolorbox}[sep=8pt,center,rounded=true,shadow=true]{title}
%       \usebeamerfont{title}\inserttitle\par%
%       \ifx\insertsubtitle\@empty%
%       \else%
%         \vskip0.25em%
%         {\usebeamerfont{subtitle}\usebeamercolor[fg]{subtitle}\insertsubtitle\par}%
%       \fi%     
%     \end{beamercolorbox}%
%     \vskip0.5em\par
%     \begin{beamercolorbox}[sep=8pt,center]{author}
%       \usebeamerfont{author}\insertauthor
%     \end{beamercolorbox}
%     \par
%     \begin{beamercolorbox}[sep=8pt,center]{institute}
%       \usebeamerfont{institute}\insertinstitute
%     \end{beamercolorbox}
%     \par
%     \begin{beamercolorbox}[sep=8pt,center]{date}
%       \usebeamerfont{date}\insertdate
%     \end{beamercolorbox}\vskip0.5em
%     {\usebeamercolor[fg]{titlegraphic}\inserttitlegraphic\par}
%   \endgroup
%   \vfill
% }


\titlegraphic{
  \def\themeMPI@logoheight{1.8\baselineskip}
  \def\themeMPI@logoboxwidth{0.28\paperwidth}
  \begin{beamercolorbox}[center]{titlegraphic}%
      \begin{minipage}{\themeMPI@logoboxwidth}%
        \centering
        \includegraphics[height=\themeMPI@logoheight]{logos/luh_logo_rgb_0_81_158.png}
      \end{minipage}%
      \begin{minipage}{\themeMPI@logoboxwidth}%
        \centering
        \includegraphics[height=\themeMPI@logoheight]{logos/group_logo.pdf}
      \end{minipage}%
      \begin{minipage}{\themeMPI@logoboxwidth}%
        \centering
        \includegraphics[height=\themeMPI@logoheight]{logos/MPI-AEI_wide_E_color_cmyk.pdf}
      \end{minipage}%
  \end{beamercolorbox}%
}


\defbeamertemplate{title page}{BMGroup}{%
  \vfill%
  \begingroup%
    % \begin{tikzpicture}[overlay,remember picture]
    %       \usebeamercolor[bg]{titlelike}
    %       \fill (current page.north west) -- +(0, -0.5\paperheight) -- +(\paperwidth, -0.42\paperheight) -- (current page.north east) -- cycle;% I do not fully understand this. But anyway, it works...
    % \end{tikzpicture}%
    % 
    {\tikz[overlay,remember picture]\node[opacity=0.1] at (current page.center){\includegraphics[height=\paperheight]{logos/waves3.png}};}%
    % {\tikz[overlay,remember picture]\node[opacity=0.1,anchor=south east] at (current page.south east){\includegraphics[height=0.5\paperheight,keepaspectratio]{logos/waves3.png}};}%
    \vskip-4em\par%
    \begin{beamercolorbox}[wd=\paperwidth,ht=0.333\paperheight,center,ignorebg]{title}%
      \usebeamerfont{title}\inserttitle\par%
      \ifx\insertsubtitle\@empty%
      \else%
        \vskip0.25em%
        {\usebeamerfont{subtitle}\usebeamercolor[fg]{subtitle}\insertsubtitle\par}%
      \fi%     
    \end{beamercolorbox}%
    \vskip5.5em\par%
    \begin{beamercolorbox}[sep=8pt,center]{author}%
      \usebeamerfont{author}\insertauthor
    \end{beamercolorbox}%
    \par%
    \begin{beamercolorbox}[sep=8pt,center]{institute}%
      \usebeamerfont{institute}\insertinstitute
    \end{beamercolorbox}%
    \par%
    \begin{beamercolorbox}[sep=8pt,center]{date}%
      \usebeamerfont{date}\insertdate
    \end{beamercolorbox}%
    \vskip1.5em%
    {\usebeamercolor[fg]{titlegraphic}\inserttitlegraphic\par}%
    % 
  \endgroup%
  \vfill%
}



% \titlegraphic{
%   \def\themeMPI@logoheight{1.8\baselineskip}
%   \def\themeMPI@logoboxwidth{0.28\paperwidth}
%   \begin{beamercolorbox}[center]{titlegraphic}%
%       \begin{minipage}{\themeMPI@logoboxwidth}%
%         \centering
%         \includegraphics[height=\themeMPI@logoheight]{logos/luh_logo_rgb_0_81_158.png}
%       \end{minipage}%
%       \begin{minipage}{\themeMPI@logoboxwidth}%
%         \centering
%         \includegraphics[height=\themeMPI@logoheight]{logos/group_logo.pdf}
%       \end{minipage}%
%       \begin{minipage}{\themeMPI@logoboxwidth}%
%         \centering
%         \includegraphics[height=\themeMPI@logoheight]{logos/MPI-AEI_wide_E_neg_cmyk.pdf}
%       \end{minipage}%
%   \end{beamercolorbox}%
% }

% -- V2, with logos stacked on top
% \titlegraphic{
%   \def\themeMPI@logoheight{1.8\baselineskip}
%   \def\themeMPI@logopadding{1.2\baselineskip}
%   \def\themeMPI@logoboxwidth{0.28\paperwidth}
%   \begin{beamercolorbox}[right]{titlegraphic}%
%       \begin{minipage}{\themeMPI@logoboxwidth}%
%         % \centering
%         \raggedleft
%         \includegraphics[height=\themeMPI@logoheight]{logos/group_logo.pdf}
%       \end{minipage}
%       \par
%       \vspace*{\themeMPI@logopadding}
%       \begin{minipage}{\themeMPI@logoboxwidth}%
%         % \centering
%         \raggedleft
%         \includegraphics[height=\themeMPI@logoheight]{logos/luh_logo_rgb_0_81_158.png}
%       \end{minipage}
%       \par
%       \vspace*{\themeMPI@logopadding}
%       \begin{minipage}{\themeMPI@logoboxwidth}%
%         % \centering
%         \raggedleft
%         \includegraphics[height=\themeMPI@logoheight]{logos/MPI-AEI_wide_E_neg_cmyk.pdf}
%       \end{minipage}
%   \end{beamercolorbox}%
% }


% -- V3, with reduced number of logos (sorry Frank)
\titlegraphic{
  \def\themeMPI@logoheight{1.8\baselineskip}
  \def\themeMPI@logoboxwidth{0.3\paperwidth}
  \begin{beamercolorbox}[center]{titlegraphic}%
      \begin{minipage}{\themeMPI@logoboxwidth}%
        % \centering
        \raggedleft
        \includegraphics[height=\themeMPI@logoheight]{logos/luh_logo_rgb_0_81_158.png}
      \end{minipage}%
      \begin{minipage}{\themeMPI@logoboxwidth}%
        \tikz[overlay, remember picture]{\node (0,0) {};}  % Just need to make it non-empty
      \end{minipage}%
      \begin{minipage}{\themeMPI@logoboxwidth}%
        \centering
        \includegraphics[height=\themeMPI@logoheight]{logos/MPI-AEI_wide_E_neg_cmyk.pdf}
      \end{minipage}%
  \end{beamercolorbox}%
}


\def\themeMPI@titlepage@leftskip{0.1\paperwidth}

\defbeamertemplate{title page}{MPIGrav}{%
    \begin{tikzpicture}[overlay,remember picture]%
        % -- V1
        % \fill[fg!50!bg] (current page.south) -- +(0.25\paperwidth, \paperheight) -- (current page.north east) -- (current page.south east) -- cycle;

        
        % -- V2
        % \fill[bg] (current page.south west) -- +(0, 0.1\paperheight) -- +(\paperwidth, 0.2\paperheight) -- (current page.south east) -- cycle;
        
        % \fill[fg!50!bg] (current page.south) -- +(0.25\paperwidth, \paperheight) -- (current page.north east) -- (current page.south east) -- cycle;


        % -- V3, as none of the above go particularly well with the titlegraphics on the bottom
        \fill[fg!50!bg] (current page.south east) -- +(-0.4\paperwidth, 0) -- +(-0.24\paperwidth, \paperheight) -- (current page.north east) -- (current page.south east) -- cycle;
    
        \node[anchor=south, yshift=10pt] at (current page.south) {\inserttitlegraphic};

        \node[anchor=north east, xshift=8pt, yshift=40pt] at (current page.north east) {\includegraphics[height=0.5\paperheight]{logos/pferd-links_Weiss.png}};
        
        % \node[anchor=south west, xshift=-20pt, yshift=-4pt] at (current page.south west) {\includegraphics[height=0.4\paperheight]{logos/pferd-links_gruen.png}};
        
        \node[anchor=south west, xshift=-20pt, yshift=-4pt] at (current page.south west) {\includegraphics[height=0.4\paperheight]{logos/Leibniz-Ganzk–§rper-Gruen.png}};
    
    \end{tikzpicture}%
    % 
    \par%
    \begin{beamercolorbox}[wd=\paperwidth,ht=0.333\paperheight,sep=8pt,leftskip=\themeMPI@titlepage@leftskip,ignorebg]{title}%
      \usebeamerfont{title}\inserttitle\par%
      \ifx\insertsubtitle\@empty%
      \else%
        \vskip0.25em%
        {\usebeamerfont{subtitle}\usebeamercolor[fg]{subtitle}\insertsubtitle\par}%
      \fi%     
    \end{beamercolorbox}%
    \vskip2.5em\par%
    \begin{beamercolorbox}[wd=\paperwidth,sep=8pt,leftskip=\themeMPI@titlepage@leftskip]{author}%
      \usebeamerfont{author}\insertauthor
    \end{beamercolorbox}%
    \par%
    \begin{beamercolorbox}[wd=\paperwidth,sep=8pt,leftskip=\themeMPI@titlepage@leftskip]{institute}%
      \usebeamerfont{institute}\insertinstitute
    \end{beamercolorbox}%
    \par%
    \begin{beamercolorbox}[wd=\paperwidth,sep=8pt,leftskip=\themeMPI@titlepage@leftskip]{date}%
      \usebeamerfont{date}\insertdate
    \end{beamercolorbox}%
}


% \setbeamertemplate{title page}[BMGroup]
\setbeamertemplate{title page}[MPIGrav]


\mode
<all>