%% start of file `beamerinnerthemeGW.sty'.
% Author: Max Melching (m-melching@web.de), 2025
%
% Acknowledgements: this theme is a based on the UC Berkeley beamer theme.
% The file structure, however, follows the DTU template from
% https://gitlab.gbar.dtu.dk/latex/dtutemplates/-/tree/master/templates/Beamer


\mode<presentation>
% -- Purpose of this file: specify how things look that make up content of the
% -- frame. For example style of enumerations etc or the table of contents.

% -- Use base class innertheme here, overwrite selected stuff afterwards ------
\useinnertheme{rounded}
% \setbeamertemplate{blocks}[rounded]


% -- Appearance and margins for items -----------------------------------------
\def\themeGW@ItemSquareSize{0.22em}
\def\themeGW@ItemInsetWidth{0.012em}

\def\GWthemeRotatedsquareItem{%
  \begin{tikzpicture}[scale=1]% scale can easily be changed here
      \draw[fill, rotate around={45:(0,0)}] (-\themeGW@ItemSquareSize,-\themeGW@ItemSquareSize) rectangle (\themeGW@ItemSquareSize,\themeGW@ItemSquareSize);
      \draw[fill, white, rotate around={45:(0,0)}] (-\themeGW@ItemInsetWidth,-1.01*\themeGW@ItemSquareSize) rectangle (\themeGW@ItemInsetWidth,1.01*\themeGW@ItemSquareSize);
      \draw[fill, white, rotate around={45:(0,0)}] (-1.01*\themeGW@ItemSquareSize,-\themeGW@ItemInsetWidth) rectangle (1.01*\themeGW@ItemSquareSize,\themeGW@ItemInsetWidth);
  \end{tikzpicture}%
}

\def\GWthemeShiftedsquareItem{%
  \begin{tikzpicture}[scale=1]% scale can easily be changed here
    \draw[fill, shift={(0.3*\themeGW@ItemSquareSize,-0.3*\themeGW@ItemSquareSize)}] (-\themeGW@ItemSquareSize,-\themeGW@ItemSquareSize) rectangle (\themeGW@ItemSquareSize,\themeGW@ItemSquareSize);
    \draw[line width=0.14*\themeGW@ItemSquareSize,fill=white] (-\themeGW@ItemSquareSize,-\themeGW@ItemSquareSize) rectangle (\themeGW@ItemSquareSize,\themeGW@ItemSquareSize);
  \end{tikzpicture}%
}

\def\GWthemeBullet{\raisebox{-3pt}{\LARGE\textbullet}}

\IfFileExists{fourier-orns.sty}{
  \RequirePackage{fourier-orns}
  \def\GWthemeStarredbullet{\raisebox{-2pt}{\LARGE\starredbullet}}
}{}


% \setbeamertemplate{itemize item}{\textbullet}
\setbeamertemplate{itemize item}{$\blacktriangleright$}
\setbeamertemplate{itemize subitem}{{\bfseries--}}
% \setbeamertemplate{itemize subitem}{\CustomStarredbullet}
% \setbeamertemplate{itemize subitem}{\leftblackhand}  % Not available yet...
\setbeamertemplate{itemize subsubitem}{\GWthemeBullet}


\setlength{\leftmargini}{1.25em}
\setlength{\leftmarginii}{1em}
\setlength{\leftmarginiii}{1em}


% -- Text margins
\setbeamersize{text margin left=2em, text margin right=2em}


% -- Captions and TOC
\setbeamertemplate{caption}[numbered]  % How captions of floats appear

\setbeamertemplate{section in toc}[sections numbered]
\setbeamertemplate{subsection in toc}[square]%[subsections numbered]


% -- Section and subsection page ----------------------------------------------
% -> adapted from: https://github.com/pcafrica/focus-beamertheme/blob/main/beamerinnerthemefocus.sty

\defbeamertemplate*{section page}{GW}{%
    {%
        \begin{tikzpicture}[overlay, remember picture]
            \usebeamercolor[bg]{section page}
            % \fill (current page.north west) rectangle ([shift = {(0, -0.45\paperheight)}] current page.north east);
            \fill (current page.north west) -- +(0, -0.6\paperheight) -- +(\paperwidth, -0.56\paperheight) -- (current page.north east) -- cycle;% I do not fully understand this. But anyway, it works...
        \end{tikzpicture}%
    }%
    % 
    \begin{minipage}[b][0.45\paperheight]{\textwidth}%
        \usebeamerfont{sectiontitle}%
        \usebeamercolor[fg]{section page}%
        \let\hyperlink\@secondoftwo\insertsection%
    \end{minipage}%
    % 
    \par%
    % 
    \begin{minipage}[t][0.5\paperheight]{\textwidth}%
        % -- Keep this for spacing reasons
        % \usebeamerfont{subsectiontitle}%
        % \usebeamercolor[bg]{section page}%
        % \insertsubsection%
    \end{minipage}%
}


\defbeamertemplate*{subsection page}{GW}{%
    {%
        \begin{tikzpicture}[overlay, remember picture]
            \usebeamercolor[bg]{subsection page}
            % \fill (current page.north west) rectangle ([shift = {(0, -0.45\paperheight)}] current page.north east);
            \fill (current page.north west) -- +(0, -0.6\paperheight) -- +(\paperwidth, -0.56\paperheight) -- (current page.north east) -- cycle;% I do not fully understand this. But anyway, it works...
          \end{tikzpicture}%
    }%
    % 
    \begin{minipage}[b][0.45\paperheight]{\textwidth}%
        \usebeamerfont{sectiontitle}%
        \usebeamercolor[fg]{subsection page}%
        \let\hyperlink\@secondoftwo\insertsection%
    \end{minipage}%
    % 
    \par%
    % 
    \begin{minipage}[t][0.5\paperheight]{\textwidth}%
        \usebeamerfont{sectionsubtitle}%
        \usebeamercolor[fg]{subsection page}%
        \let\hyperlink\@secondoftwo\insertsubsection%
    \end{minipage}%
}


\newcommand{\insertsectionpage}{%
  \begin{frame}[plain, noframenumbering]{}{}
    \sectionpage
  \end{frame}%
}

\newcommand{\insertsubsectionpage}{%
  \begin{frame}[plain, noframenumbering]{}{}
    \subsectionpage
  \end{frame}%
}



% -- Title page ---------------------------------------------------------------
\RequirePackage{tikz}
\RequirePackage{calc}


\def\themeGW@titlepage@leftskip{0.1\paperwidth}
\def\themeGW@logoheight{1.8\baselineskip}
\def\themeGW@logoboxwidth{0.3\paperwidth}

\titlegraphic{
  \begin{beamercolorbox}[center]{titlegraphic}%
      \begin{minipage}{\themeGW@logoboxwidth}%
        \tikz[overlay, remember picture]{\node (0,0) {};}  % Just need to make it non-empty
      \end{minipage}%
      \begin{minipage}{\themeGW@logoboxwidth}%
        \tikz[overlay, remember picture]{\node (0,0) {};}  % Just need to make it non-empty
      \end{minipage}%
      \begin{minipage}{\themeGW@logoboxwidth}%
        \centering
        \tikz{\node[anchor=south, yshift=10pt] at (current page.south) {\pgfuseimage{logo}};}
      \end{minipage}%
  \end{beamercolorbox}%
}

\defbeamertemplate*{title page}{GW}{%
    \vskip-\themeGW@headerskip%  Cancel shift coming in from frametitle
    \vskip0.0667\paperheight%  Gives good separation
    \begin{tikzpicture}[overlay,remember picture]%
        % -- V1
        % \fill[fg!50!bg] (current page.south) -- +(0.25\paperwidth, \paperheight) -- (current page.north east) -- (current page.south east) -- cycle;

        
        % -- V2
        % \fill[bg] (current page.south west) -- +(0, 0.1\paperheight) -- +(\paperwidth, 0.2\paperheight) -- (current page.south east) -- cycle;
        
        % \fill[fg!50!bg] (current page.south) -- +(0.25\paperwidth, \paperheight) -- (current page.north east) -- (current page.south east) -- cycle;


        % -- V3, as none of the above go particularly well with the titlegraphics on the bottom
        \fill[
            % fg!50!bg,
            fg,
        ] (current page.south east) -- +(-0.4\paperwidth, 0) -- +(-0.24\paperwidth, \paperheight) -- (current page.north east) -- (current page.south east) -- cycle;
    
        % \node[anchor=south east,inner sep=0pt,draw=none,xshift=-10pt,yshift=10pt] at (current page.south east) {\pgfuseimage{logo}};
        \node[anchor=south, yshift=10pt] at (current page.south) {\inserttitlegraphic};
        
        % \node[xshift=0.1\paperheight, opacity=0.2] at (current page.west) {\includegraphics[height=0.8\paperheight]{logos/Max_Planck_Minerva_DarkGray.pdf}};
      \end{tikzpicture}%
    % 
    \par%
    \begin{beamercolorbox}[wd=\paperwidth,ht=0.333\paperheight,sep=8pt,leftskip=\themeGW@titlepage@leftskip,ignorebg]{title}%
      \usebeamerfont{title}\inserttitle\par%
      \ifx\insertsubtitle\@empty%
      \else%
        \vskip0.25em%
        {\usebeamerfont{subtitle}\usebeamercolor[fg]{subtitle}\insertsubtitle\par}%
      \fi%     
    \end{beamercolorbox}%
    \vskip2.5em\par%
    \begin{beamercolorbox}[wd=\paperwidth,sep=8pt,leftskip=\themeGW@titlepage@leftskip]{author}%
      \usebeamerfont{author}\insertauthor
    \end{beamercolorbox}%
    \par%
    \begin{beamercolorbox}[wd=\paperwidth,sep=8pt,leftskip=\themeGW@titlepage@leftskip]{institute}%
      \usebeamerfont{institute}\insertinstitute
    \end{beamercolorbox}%
    \par%
    \begin{beamercolorbox}[wd=\paperwidth,sep=8pt,leftskip=\themeGW@titlepage@leftskip]{date}%
      \usebeamerfont{date}\insertdate
    \end{beamercolorbox}%
}


% \addtobeamertemplate{titlepage}{}{%
%     \begin{tikzpicture}[overlay, remember picture]
%         \node[xshift=0.1\paperheight, opacity=0.2] at (current page.west) {\includegraphics[height=0.8\paperheight]{logos/Max_Planck_Minerva_DarkGray.pdf}};
%     \end{tikzpicture}%
% }


\def\themeGW@logoheight{1.8\baselineskip}
\def\themeGW@logoboxwidth{0.3\paperwidth}

\def\GWthemestandardtitlegraphic{
  \begin{beamercolorbox}[center]{titlegraphic}%
      \begin{minipage}{\themeGW@logoboxwidth}%
        % \centering
        \raggedleft
        \includegraphics[height=\themeGW@logoheight]{logos/luh_logo_rgb_0_81_158.png}
      \end{minipage}%
      \begin{minipage}{\themeGW@logoboxwidth}%
        \tikz[overlay, remember picture]{\node (0,0) {};}  % Just need to make it non-empty
      \end{minipage}%
      \begin{minipage}{\themeGW@logoboxwidth}%
        \centering
        \includegraphics[height=\themeGW@logoheight]{logos/MPI-AEI_wide_E_neg_cmyk.pdf}
      \end{minipage}%
  \end{beamercolorbox}%
}

\def\themeGW@titlepage@leftskip{0.05\paperwidth}

\defbeamertemplate{title page}{MPIGrav}{%
    \vskip-\themeGW@headerskip%  Cancel shift coming in from frametitle
    \vskip0.0667\paperheight%  Gives good separation
    \begin{tikzpicture}[overlay,remember picture]%
        % -- V1
        % \fill[fg!50!bg] (current page.south) -- +(0.25\paperwidth, \paperheight) -- (current page.north east) -- (current page.south east) -- cycle;

        
        % -- V2
        % \fill[bg] (current page.south west) -- +(0, 0.1\paperheight) -- +(\paperwidth, 0.2\paperheight) -- (current page.south east) -- cycle;
        
        % \fill[fg!50!bg] (current page.south) -- +(0.25\paperwidth, \paperheight) -- (current page.north east) -- (current page.south east) -- cycle;


        % -- V3, as none of the above go particularly well with the titlegraphics on the bottom
        \fill[
            % fg!50!bg,
            fg,
        ] (current page.south east) -- +(-0.4\paperwidth, 0) -- +(-0.24\paperwidth, \paperheight) -- (current page.north east) -- (current page.south east) -- cycle;
    
        \node[anchor=south, yshift=10pt] at (current page.south) {\inserttitlegraphic};

        \node[anchor=north east, xshift=8pt, yshift=40pt] at (current page.north east) {\includegraphics[height=0.5\paperheight]{logos/pferd-links_Weiss.png}};
        
        % \node[anchor=south west, xshift=-20pt, yshift=-4pt] at (current page.south west) {\includegraphics[height=0.4\paperheight]{logos/pferd-links_gruen.png}};
        
        \node[anchor=south west, xshift=-20pt, yshift=-4pt] at (current page.south west) {\includegraphics[height=0.4\paperheight]{logos/Leibniz-Ganzk–§rper-Gruen.png}};
    
    \end{tikzpicture}%
    % 
    \par%
    \begin{beamercolorbox}[wd=0.6\paperwidth,ht=0.333\paperheight,sep=8pt,leftskip=\themeGW@titlepage@leftskip,ignorebg]{title}%
      \centering%
      \usebeamerfont{title}\inserttitle\par%
      \ifx\insertsubtitle\@empty%
      \else%
        \vskip0.25em%
        {\usebeamerfont{subtitle}\usebeamercolor[fg]{subtitle}\insertsubtitle\par}%
      \fi%     
    \end{beamercolorbox}%
    \vskip2.5em\par%
    \begin{beamercolorbox}[wd=0.6\paperwidth,sep=8pt,leftskip=\themeGW@titlepage@leftskip]{author}%
      \centering%
      \usebeamerfont{author}\insertauthor
    \end{beamercolorbox}%
    \par%
    \begin{beamercolorbox}[wd=0.6\paperwidth,sep=8pt,leftskip=\themeGW@titlepage@leftskip]{institute}%
      \centering%
      \usebeamerfont{institute}\insertinstitute
    \end{beamercolorbox}%
    \par%
    \begin{beamercolorbox}[wd=0.6\paperwidth,sep=8pt,leftskip=\themeGW@titlepage@leftskip]{date}%
      \centering%
      \usebeamerfont{date}\insertdate
    \end{beamercolorbox}%
}


% \setbeamertemplate{title page}[default][left]

% \titlegraphic{\BMGrouptitlegraphic}
% \setbeamertemplate{title page}[BMGroup]

% \titlegraphic{\GWthemestandardtitlegraphic}
% \setbeamertemplate{title page}[MPIGrav]


\mode
<all>